{% extends "base.html" %}
{% block content %}
<div class="container-fluid vh-100 d-flex align-items-center justify-content-center">
    <div class="row w-100">
        <div class="col-md-4 offset-md-4">
            <div class="glass-card rounded-3 p-4">
                <div class="text-center mb-4">
                    <h2 class="text-white">
                        {% if mode == 'register' %}Create Account{% else %}Welcome Back{% endif %}
                    </h2>
                </div>
                
                <div id="alertContainer"></div>
                
                <form id="authForm">
                    {% if mode == 'register' %}
                    <div class="mb-3">
                        <input type="email" class="form-control" id="email" placeholder="Email" required>
                    </div>
                    {% endif %}
                    
                    <div class="mb-3">
                        <input type="text" class="form-control" id="username" placeholder="Username" required>
                    </div>
                    
                    <div class="mb-3">
                        <input type="password" class="form-control" id="password" placeholder="Password" required>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            {% if mode == 'register' %}Register{% else %}Login{% endif %}
                        </button>
                        
                        <a href="{% if mode == 'register' %}/login{% else %}/register{% endif %}" 
                           class="btn btn-outline-light">
                            {% if mode == 'register' %}Already have an account? Login{% else %}Don't have an account? Register{% endif %}
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('authForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = {
        username: document.getElementById('username').value,
        password: document.getElementById('password').value
    };
    
    {% if mode == 'register' %}
    formData.email = document.getElementById('email').value;
    {% endif %}
    
    try {
        const response = await fetch('{{ url_for(request.endpoint) }}', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            {% if mode == 'register' %}
            showAlert('Registration successful! Redirecting to login...', 'success');
            setTimeout(() => window.location.href = '/login', 1500);
            {% else %}
            window.location.href = '/dashboard';
            {% endif %}
        } else {
            showAlert(data.message, 'danger');
        }
    } catch (error) {
        showAlert('An error occurred. Please try again.', 'danger');
    }
});

function showAlert(message, type) {
    document.getElementById('alertContainer').innerHTML = 
        `<div class="alert alert-${type} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>`;
}
</script>
{% endblock %}